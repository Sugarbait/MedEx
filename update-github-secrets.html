<!DOCTYPE html>
<html>
<head>
    <title>Update GitHub Secrets for MedEx Azure Deployment</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 30px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #d97706;
            margin-bottom: 10px;
            font-size: 32px;
        }
        .subtitle {
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
        }
        .error-box {
            background: #fef3c7;
            border: 3px solid #f59e0b;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .error-box h2 {
            margin-top: 0;
            color: #92400e;
        }
        .step {
            background: #f8f9ff;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #3b82f6;
            border-radius: 6px;
        }
        .step h2 {
            margin-top: 0;
            color: #1e40af;
            font-size: 20px;
        }
        .code-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-x: auto;
            margin: 15px 0;
            position: relative;
        }
        .code-box code {
            color: #9cdcfe;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin: 10px 5px;
        }
        button:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        button.success {
            background: #10b981;
        }
        button.success:hover {
            background: #059669;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4c5fd5;
            padding: 6px 12px;
            font-size: 12px;
        }
        .highlight {
            background: #fef3c7;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }
        .value-box {
            background: #dcfce7;
            border: 2px solid #10b981;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
        }
        .old-value {
            background: #fee2e2;
            border-color: #dc2626;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            text-align: left;
            padding: 12px;
            border: 1px solid #e5e7eb;
        }
        th {
            background: #f3f4f6;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Update GitHub Secrets for MedEx Azure</h1>
        <p class="subtitle">Fix Azure deployment to use correct MedEx database</p>

        <div class="error-box">
            <h2>‚ö†Ô∏è Current Issue:</h2>
            <p><strong>Azure production is connecting to the wrong database!</strong></p>
            <p>Current: <code>cpkslvmydfdevdftieck.supabase.co</code> (CareXPS - OLD)</p>
            <p>Should be: <code>onwgbfetzrctshdwwimm.supabase.co</code> (MedEx - CORRECT)</p>
        </div>

        <div class="step">
            <h2>üîç Why This Happened</h2>
            <p>The Azure deployment workflow uses <strong>GitHub Secrets</strong> for environment variables:</p>
            <div class="code-box">
                <code>env:
  VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
  VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY }}</code>
            </div>
            <p>These secrets are currently set to the old CareXPS database values.</p>
        </div>

        <div class="step">
            <h2>Step 1: Open GitHub Repository Settings</h2>
            <p>Click the button below to open your GitHub repository secrets page:</p>
            <button onclick="openGitHubSecrets()">üöÄ Open GitHub Secrets</button>
        </div>

        <div class="step">
            <h2>Step 2: Update These Secrets</h2>
            <p>You need to update <strong>2 secrets</strong> to point to the MedEx database:</p>

            <table>
                <tr>
                    <th>Secret Name</th>
                    <th>Action</th>
                    <th>New Value</th>
                </tr>
                <tr>
                    <td><code>VITE_SUPABASE_URL</code></td>
                    <td>Update</td>
                    <td>
                        <button class="copy-btn" onclick="copyText('https://onwgbfetzrctshdwwimm.supabase.co')">üìã Copy</button>
                        <code>https://onwgbfetzrctshdwwimm.supabase.co</code>
                    </td>
                </tr>
                <tr>
                    <td><code>VITE_SUPABASE_ANON_KEY</code></td>
                    <td>Update</td>
                    <td>
                        <button class="copy-btn" onclick="copyAnonKey()">üìã Copy</button>
                        <code id="anonKey">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ud2diZmV0enJjdHNoZHd3aW1tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5ODA5ODYsImV4cCI6MjA3NTU1Njk4Nn0.MgsjiXT2Y0WqQf2puG2p27tHaMRfhiUET2TDWc668lI</code>
                    </td>
                </tr>
            </table>

            <div id="copySuccess" style="display: none; color: #10b981; font-weight: 600; margin-top: 10px;">
                ‚úÖ Copied to clipboard!
            </div>
        </div>

        <div class="step">
            <h2>Step 3: How to Update a Secret</h2>
            <ol>
                <li>In the GitHub Secrets page, find the secret name (e.g., <code>VITE_SUPABASE_URL</code>)</li>
                <li>Click the <span class="highlight">Update</span> button next to it</li>
                <li>Click the <span class="highlight">üìã Copy</span> button above to copy the new value</li>
                <li>Paste the new value into the "Value" field</li>
                <li>Click <span class="highlight">Update secret</span></li>
                <li>Repeat for <code>VITE_SUPABASE_ANON_KEY</code></li>
            </ol>
        </div>

        <div class="step">
            <h2>Step 4: Trigger New Deployment</h2>
            <p>After updating the secrets, you need to trigger a new deployment:</p>
            <ol>
                <li>Go to the <strong>Actions</strong> tab in your GitHub repository</li>
                <li>Click on the <strong>"Azure Static Web Apps CI/CD - MedEx"</strong> workflow</li>
                <li>Click <span class="highlight">Run workflow</span> button</li>
                <li>Select the <code>main</code> branch</li>
                <li>Click <span class="highlight">Run workflow</span> to start deployment</li>
            </ol>
            <button onclick="openGitHubActions()">üîÑ Open GitHub Actions</button>
        </div>

        <div class="step">
            <h2>Step 5: Wait for Deployment (3-5 minutes)</h2>
            <p>Watch the deployment progress in the Actions tab. When complete:</p>
            <ol>
                <li>The workflow will show a green checkmark ‚úÖ</li>
                <li>Azure will be updated with the correct database</li>
                <li>Login should work at <strong>https://medex.nexasync.ca</strong></li>
            </ol>
        </div>

        <div style="margin-top: 40px; padding: 20px; background: #f3f4f6; border-radius: 8px;">
            <h3 style="margin-top: 0;">üîç What This Fix Does:</h3>
            <ul style="line-height: 1.8;">
                <li><strong>Updates Supabase URL</strong> - Points to correct MedEx database</li>
                <li><strong>Updates API Keys</strong> - Uses correct anon key for MedEx</li>
                <li><strong>Preserves RLS Policies</strong> - Your RLS fix from earlier will now work</li>
                <li><strong>Automatic Deployment</strong> - GitHub Actions rebuilds with new values</li>
            </ul>
        </div>
    </div>

    <script>
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                document.getElementById('copySuccess').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('copySuccess').style.display = 'none';
                }, 3000);
            });
        }

        function copyAnonKey() {
            const key = document.getElementById('anonKey').textContent;
            copyText(key);
        }

        function openGitHubSecrets() {
            window.open('https://github.com/Sugarbait/MedEx/settings/secrets/actions', '_blank');
        }

        function openGitHubActions() {
            window.open('https://github.com/Sugarbait/MedEx/actions', '_blank');
        }
    </script>
</body>
</html>
